# Analyze system log

`systemd` has centralized logging mechanism which collects logs from all user processes in the system and kernel as well. This is called `journal`. systemd runs a journal daemon `journald`, which collects messages from the kernel, initrd, services, etc.

Analyzing logs is the most effective way to diagnose issues with any systemd service. In Ghaf OS, the default systemd log level is set to `info`. To gain deeper insights into the service state, the log level can be elevated to `debug`. This can be done by enabling the following option:

XXXXXXXXXXXX

While it is possible to elevate the log level on a live system using `systemctl`, this option is particularly useful when you need to inspect the startup sequence of critical services that cannot be restarted in a live environment.

To change the log level to `debug`, you can run the following `systemctl` command:

```bash
$> sudo systemctl log-level debug
```

This command will change the log level for the systemd daemon and all systemd-managed services.

After adjusting the log level, it is recommended to reload the systemd daemon and restart the service you are debugging.

## `journalctl`

When `journalctl` command is run without any option, it will show all the messages, which can be pretty long.

1. You can see logs of specific boot using -b option for example:

```bash
$> journalctl -b  #Log from current boot
$> journalctl -b -1 #Log from previous boo
```

2. To list available boots, use the following command.

```
$> journalctl --list-boots
```

3. To view the logs generated by any systemd unit, use the `-u` option. For example, the command below displays all logs recorded by the logind service. You can specify multiple units by using the -u` switch more than once.

```bash
$> journalctl -u logind.service
```

4. `You can see log messages in real-time, similar to the `tail`command in Linux. To do this, use the`-f` option:

```bash
$> journalctl -f
```

5. Similar to the `tail`command, the`-n` option allows you to display a specific number of the most recent log entries. The following command shows the last 50 messages logged.

```bash
$> journalctl -n 50
```

6. Log messages can be filtered based on their priority using -p option, for example follwing command will show only error message from service logind

   ```bash
   $> journalctl -p error -u logind.service
   ```
7. To see kernel message use following options:

   ```bash
   $> journalctl -k
   $> journalctl -t kernel
   ```
8. The `-r` option displays log entries in reverse chronological order, with the latest messages shown first.

## Troubleshoot when system doesn't boot due to failure of a critical service

In some cases, the system may fail to boot due to the failure of a critical service. If this happens, you can follow these steps to diagnose the issue with systemd services:

1. Increase the systemd log level using the previously mentioned option, and load the image.
2. Reboot the system. As expected, you will encounter a boot failure.
3. Force reboot the machine. When the machine starts again, interrupt the bootloader and add the following to the bootloader command line:

   ```
   rescue systemd.setenv=SYSTEMD_SULOGIN_FORCE=1
   ```
   To modify the bootloader command, select the boot option and then press the 'e' key.
4. You will now enter an early shell environment. Here, you can access the logs from the previous boot using `journalctl`. The logs will help you identify any service failures.
